{% extends 'base/index.html' %}

{% block title %}
Quiz Time | {{site_name}}
{% endblock title %}


{% block content %}
<div class="container pt-3">
    <div class="container2">
        <div id="quiz-container">
        </div>
        <div id="result-container">
            <h2>Your Final Score: <span id="final-score">0</span></h2>
            <p id="mental-health-message"></p>
        </div>
    </div>
</div>
{% endblock content %}


{% block styles %}
<style>
    .container2 {
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    #quiz-container {
        max-width: 600px;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    form {
        margin-top: 20px;
    }

    div {
        margin-bottom: 10px;
    }

    button {
        padding: 10px;
        background-color: #4caf50;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    button:hover {
        background-color: #45a049;
    }

    #result-container {
        display: none;
    }
</style>
{% endblock styles %}

{% block scripts %}
    <script>
        const quizData = {{ quizData|safe }};

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        const shuffledQuizData = shuffleArray(quizData);

        let currentQuestion = 0;
        let score = 0;
        const quizContainer = document.getElementById('quiz-container');
        const resultContainer = document.getElementById('result-container');
        const finalScoreElement = document.getElementById('final-score');
        let timer;
        const timerDuration = 30; 

        function displayQuestion() {
            if (currentQuestion < 10) {
                const questionData = shuffledQuizData[currentQuestion];

                let optionsHTML = '';
                const shuffledOptions = shuffleArray(questionData.Options);
                shuffledOptions.forEach((option, index) => {
                    optionsHTML += `<div><input type="radio" name="option" value="${index}">${option}</div>`;
                });

                quizContainer.innerHTML = `
                    <h2>${questionData.Question}</h2>
                    <form id="quiz-form">
                        ${optionsHTML}
                        <button type="button" onclick="checkAnswer()">Submit</button>
                    </form>
                    <p id="timer"></p>
                `;

                startTimer();
            } else {
                showResult();
            }
        }

        function startTimer() {
            let timeLeft = timerDuration;
            timer = setInterval(() => {
                document.getElementById('timer').innerText = `Time Left: ${timeLeft} seconds`;

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    checkAnswer();
                }

                timeLeft--;
            }, 1000);
        }

        function checkAnswer() {
            clearInterval(timer);

            const selectedOption = document.querySelector('input[name="option"]:checked');
            if (selectedOption) {
                const selectedOptionIndex = parseInt(selectedOption.value);
                const questionData = shuffledQuizData[currentQuestion];

                if (questionData.Options[selectedOptionIndex] === questionData.Correct5 ||
                    questionData.Options[selectedOptionIndex] === questionData.Correct3) {
                    if (questionData.Options[selectedOptionIndex] === questionData.Correct5) {
                        score += 5;
                    } else {
                        score += 3;
                    }
                }

                currentQuestion++;
                displayQuestion();
            }
        }

        function showResult() {
            quizContainer.style.display = 'none';
            resultContainer.style.display = 'block';

            const mentalHealthScore = score * 2;

            finalScoreElement.innerText = mentalHealthScore;

            const mentalHealthMessageElement = document.getElementById('mental-health-message');
            if (mentalHealthScore < 45) {
                mentalHealthMessageElement.innerText = "Your Mental Health is Not Good. Give rest to your mind and visit a doctor.";
            } else if (mentalHealthScore >= 45 && mentalHealthScore <= 85) {
                mentalHealthMessageElement.innerText = "Your Mental Health is Good. You can relax and work harder.";
            } else {
                mentalHealthMessageElement.innerText = "Your Mental Health is Awesome. You are fully energetic to Rock!";
            }
        }

        displayQuestion();
    </script>
{% endblock scripts %}